# Java中的堆和栈
> Java 把内存划分为两种：一种是栈内存，一种是堆内存。

1. 栈（stack）与堆（heap）都是Java用来在Ram中存放数据的地方。与C++不同，Java自动管理栈和堆，程序员不能直接的设置栈或堆。
2. 栈的优势是，存取速度比堆要快，仅次于直接位于CPU中的寄存器。但缺点是，存在栈中的数据大小与生存期必须是确定的，缺乏灵活性。另外，栈数据可以共享。堆的优势是可以动态分配内存大小，生存期也不必事先告诉编译器。Java的垃圾回收器会自动回收不再使用的数据。但缺点是由于要在运行时动态分配内存，存取速度较慢。
3. Java中的基本类型有两种：
  * 一种是``基本类型``(primitive types), 共有8种，即int, short, long, byte, float, double, boolean, char(注意并没有string的基本类型)。这种类型的定义是通过诸如int a = 3; long b = 255L;的形式来定义的，称为自动变量。值得注意的是，`自动变量存的是字面值，不是类的实例，即不是类的引用，`这里并没有类的存在。如int a = 3; 这里的a是一个指向int类型的引用，指向3这个字面值。这些字面值的数据，由于大小可知，生存期可知(这些字面值固定定义在某个程序块里面，程序块退出后，字段值就消失了)，出于追求速度的原因，就存在于栈中。

      * 另外，栈有一个很重要的特殊性，`就是存在栈中的数据可以共享`。假设我们同时定义：int a = 3;  int b = 3; 编译器先处理int a = 3；首先它会在栈中创建一个变量为a的引用，然后查找有没有字面值为3的地址，没找到，就开辟一个存放3这个字面值的地址，然后将a指向3的地址。接着处理int b = 3；在创建完b的引用变量后，由于在栈中已经有3这个字面值，便将b直接指向3的地址。这样，就出现了a与b同时均指向3的情况。  
      * 特别注意的是，这种字面值的引用与类对象的引用不同。假定两个类对象的引用同时指向一个对象，如果一个对象引用变量修改了这个对象的内部状态，那么另一个对象引用变量也即刻反映出这个变化。相反，通过字面值的引用来修改其值，不会导致另一个指向此字面值的 引用的值也跟着改变的情况。如上例，我们定义完a与b的值后，再令a=4；那么，b不会等于4，还是等于3。在编译器内部，遇到a=4；时，它就会重新搜索栈中是否有4的字面值，如果没有，重新开辟地址存放4的值；如果已经有了，则直接将a指向这个地址。因此a值的改变不会影响到b的值。
  * 另一种是`包装类数据`，如Integer, String, Double等将相应的基本数据类型包装起来的类。这些类数据全部存在于堆中，Java用new()语句来显式的告诉编译器，在运行时才根据需要动态创建，因此比较灵活，但缺点是要占用更多的时间。

4. 在Java中有六个不同的地方可以存储数据：
  * `寄存器（register）`：这是最快的存储区，因为他位于不同于其他存储区的地方——处理器内部。但是寄存器的数量及其有限，所以寄存器由编译器根据需求进行分配，我们不能直接控制，也不能在程序中感觉到寄存器存在的任何痕迹。
  *  `堆栈（stack）`:位于通用RAM中，但通过它的“堆栈指针”可以从处理器哪里获得支持。堆栈指针若向下移动，则分配新的内存；若
向上移动，则释放那些内存。这是一种快速有效的分配存储方法，仅次于寄存器。创建程序时候，JAVA编译器必须知道存储在堆栈内所
有数据的确切大小和生命周期，因为它必须生成相应的代码，以便上下移动堆栈指针。这一约束限制了程序的灵活性，所以虽然某些JA
VA数据存储在堆栈中——特别是对象引用，但是JAVA对象不存储其中。
  * `堆`:一种通用性的内存池（也存在于RAM中），用于存放所以的JAVA对象。堆不同于堆栈的好处是：编译器不需要知道要从堆
里分配多少存储区域，也不必知道存储的数据在堆里存活多长时间。因此，在堆里分配存储有很大的灵活性。当你需要创建一个对象的时候
，只需要new写一行简单的代码，当执行这行代码时，会自动在堆里进行存储分配。当然，为这种灵活性必须要付出相应的代码。用堆进行
存储分配比用堆栈进行存储存储需要更多的时间。
  * `静态存储`：这里的“静态”是指“在固定的位置”。静态存储里存放程序运行时一直存在的数据。你可用关键字static
来标识一个对象的特定元素是静态的，但JAVA对象本身从来不会存放在静态存储空间里。
  * `常量存储`：常量值通常直接存放在程序代码内部，这样做是安全的，因为它们永远不会被改变。有时，在嵌入
式系统中，常量本身会和其他部分分割离开，所以在这种情况下，可以选择将其放在ROM中 。
  * `非RAM存储`：如果数据完全存活于程序之外，那么它可以不受程序的任何控制，在程序没有运行时也可以存在。

>  就速度而言：寄存器 > 堆栈 > 堆 > 其他

![堆栈](E:\Github\StudyNotes\Picture\堆栈.jpg)

![堆栈1](E:\Github\StudyNotes\Picture\堆栈1.png)

程序中定义的类的变量实际上是一个引用，它被存放在栈内存里，指向实际的类对象，而真正的类对象存放在堆内存里。栈内存里的引用变量并未真正存储对象的成员变量，对象的成员变量数据实际存放在堆内存里，而引用变量只是指向该堆内存里的对象。当一个对象被创建成功以后，这个对象将被保存在堆内存中，Java程序不允许直接访问堆内存中的对象，只能通过该对象的引用操作该对象。
